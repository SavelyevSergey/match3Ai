# 5. Прогрессия и сложность

[◀ Назад к оглавлению](README.md) | [▶ Следующий раздел: UI/UX](06_UI_UX.md)

---
## 3. Прогрессия и сложность

### 3.1. Структура уровней

#### 3.1.1. Количество уровней
- **На релиз:** 60-100 уровней (рекомендация: 80)
- **График добавления:** Регулярное добавление новых уровней (post-launch)
- **Группировка:** эпизоды по 15-20 уровней

#### 3.1.2. Формат хранения уровней
- **Рекомендуемый вариант:** ScriptableObject (Unity-native)
- **Альтернатива:** JSON файлы (для возможности hot-reload)
- **Структура данных:**
```csharp
[CreateAssetMenu(fileName = "Level", menuName = "Match3/Level")]
public class LevelData : ScriptableObject
{
    public int levelNumber;
    public LevelGridConfig gridConfig;
    public LevelType levelType;
    public Objective[] objectives;
    public int movesAllowed;
    public int[] starThresholds = new int[3];
    public ObstacleSpawnData[] obstacles;
    public ElementWeights elementWeights;
}
```

---

### 3.2. Кривая сложности

#### 3.2.1. Параметры сложности

**Математическая модель сложности:**
```
Difficulty = f(
    element_types,      // Количество типов элементов на поле (5-7)
    move_count,         // Количество доступных ходов
    obstacle_density,   // Плотность препятствий (0.0 - 1.0)
    obstacle_complexity,// Средний HP препятствий
    target_difficulty   // Сложность целей (количество, тип)
)

Difficulty_score = 
    (element_types × 10) +
    (100 / move_count) +
    (obstacle_density × 50) +
    (obstacle_complexity × 15) +
    (target_difficulty × 20)
```

**Диапазоны сложности:**
- **Easy:** 0-50
- **Medium:** 51-100
- **Hard:** 101-150
- **Expert:** 151+

#### 3.2.2. Принципы балансировки

**Кривая прогрессии (по уровням):**
```
Levels 1-10:   Easy (обучение базовым механикам)
Levels 11-20:  Easy → Medium (введение препятствий)
Levels 21-40:  Medium (основная игра)
Levels 41-60:  Medium → Hard (сложные комбинации)
Levels 61+:    Hard + Expert peaks
```

**Чередование сложности (Wave Pattern):**
- 3 Medium → 1 Easy (отдых)
- 5 Medium → 1 Hard → 1 Easy
- Не более 2 Hard подряд

**Hard Levels (повышенной сложности):**
- Частота: каждый 10-й уровень (10, 20, 30, 40...)
- Дополнительные награды за прохождение
- Опциональность: можно пропустить после 3 неудачных попыток (опционально)

#### 3.2.3. Параметры по уровням прогрессии

| Уровни | Типы элементов | Ходы | Плотность препятствий | Типы препятствий |
|--------|---------------|------|----------------------|-----------------|
| 1-10   | 4-5           | 30-35 | 0-10% | Ice 1 слой |
| 11-20  | 5             | 25-30 | 10-20% | Ice, Box |
| 21-40  | 5-6           | 20-25 | 20-40% | Ice, Box, Jelly |
| 41-60  | 6             | 18-22 | 30-50% | + Stone, Chain |
| 61-80  | 6-7           | 15-20 | 40-60% | + многослойные |
| 81+    | 7             | 12-18 | 50-70% | + Spawners |

#### 3.2.4. Система весов для генерации

**Базовые веса элементов:**
```csharp
public class ElementWeights
{
    public Dictionary<ElementType, float> baseWeights = new Dictionary<ElementType, float>
    {
        { ElementType.Red, 1.0f },
        { ElementType.Blue, 1.0f },
        { ElementType.Green, 1.0f },
        { ElementType.Yellow, 1.0f },
        { ElementType.Purple, 1.0f },
        { ElementType.Orange, 0.0f } // не используется в ранних уровнях
    };
    
    public float objectiveBoost = 1.5f; // множитель для целевых элементов
}
```

**Динамическая корректировка в процессе уровня:**
```
objective_progress = collected / target
if objective_progress < 0.5:
    weight_multiplier = 1.5
else if objective_progress < 0.8:
    weight_multiplier = 1.2
else:
    weight_multiplier = 1.0
```

#### 3.2.5. Формулы расчёта Win Rate

**Целевой Win Rate:**
- Easy levels: 80-90%
- Medium levels: 60-70%
- Hard levels: 30-50%
- Expert levels: 20-40%

**Формула оценки Win Rate (симуляция):**
```
Simulated_WinRate = successful_runs / total_simulation_runs

где total_simulation_runs = 100
и successful_runs = количество успешных прохождений AI-агентом
```

**Корректировка параметров при несоответствии:**
- Если WinRate < target: увеличить ходы на 10-20% или уменьшить препятствия
- Если WinRate > target: уменьшить ходы или увеличить сложность целей

---

### 3.3. Система звёзд и рейтингов

#### 3.3.1. Формула подсчёта очков

**Базовые очки за матч:**
```
Match_Score = element_count × element_base_value × combo_multiplier × cascade_multiplier

где:
element_base_value = 100 (константа)
combo_multiplier = 1.0 + (combo_count × 0.1)
cascade_multiplier = 1.0 + (cascade_level × 0.2)
```

**Очки за бустеры:**
```
Booster_Score = booster_base_value × activation_multiplier

Значения:
- Striped: 500
- Wrapped: 750
- Color Bomb: 1000
- Striped + Striped: 1500
- Wrapped + Wrapped: 2000
- Color Bomb + любой: 3000
```

**Очки за уничтожение препятствий:**
```
Obstacle_Score = obstacle_type_value × layer

Значения:
- Ice: 50 × layer
- Box: 100
- Stone: 150 × layer
- Chain: 75
- Jelly: 100 × layer
```

#### 3.3.2. Пороговые значения для звёзд

**Формула расчёта порогов:**
```
Star_1_Threshold = base_target_score
Star_2_Threshold = base_target_score × 1.5
Star_3_Threshold = base_target_score × 2.0

где base_target_score зависит от сложности уровня
```

**Базовые целевые очки (примерные):**
- Easy: 5,000 - 10,000
- Medium: 10,000 - 20,000
- Hard: 20,000 - 40,000
- Expert: 40,000+

#### 3.3.3. Бонусы за оставшиеся ходы

**Формула:**
```
Bonus_Score = remaining_moves × move_bonus_value × booster_conversion

где:
move_bonus_value = 500 (базовое значение за 1 ход)
booster_conversion = случайные элементы превращаются в бустеры и активируются
```

**Последовательность активации бонусов:**
1. Каждый оставшийся ход превращает 1-2 случайных элемента в бустеры
2. Бустеры автоматически активируются
3. Подсчёт очков от активации
4. Финальный счёт = game_score + bonus_score

#### 3.3.4. Множители за комбо

**Комбо-система:**
```
Combo_count = количество последовательных каскадных матчей без хода игрока

Combo_multiplier:
- Combo 1: ×1.0
- Combo 2: ×1.1
- Combo 3: ×1.2
- Combo 4: ×1.3
- Combo 5+: ×1.5 (cap)
```

**Сброс комбо:**
- При новом ходе игрока
- При отсутствии матчей после падения

#### 3.3.5. Награды за звёзды

**Прогрессия:**
- 1 звезда: открытие следующего уровня
- 2 звезды: открытие + бонусная валюта (например, 100 монет)
- 3 звезды: открытие + повышенная награда (200 монет) + достижение

**Повторное прохождение:**

[◀ Предыдущий раздел: Техническая специфика](04_Техническая_специфика.md) | [▶ Следующий раздел: UI/UX](06_UI_UX.md)
