# Детальный анализ плана разработки Match-3 игры

## Введение

Данный документ представляет собой комплексный анализ плана разработки Match-3 игры для платформы Android на движке Unity 2022.3.62f3. Анализ охватывает все ключевые аспекты плана: цели и задачи, временные рамки, распределение ресурсов, зависимости между элементами и потенциальные риски реализации.

---

## 1. Противоречия в количественных показателях уровней

### 1.1. Несоответствие целевого количества уровней на релиз

**Расположение противоречия:**
- [`09_План_разработки.md:99`](Docs/Plan/09_План_разработки.md:99) — Roadmap указывает "Global Launch: ✅ 100 уровней"
- [`05_Прогрессия_и_сложность.md:11`](Docs/Plan/05_Прогрессия_и_сложность.md:11) — "На релиз: 60-100 уровней (рекомендация: 80)"
- [`09_План_разработки.md:47`](Docs/Plan/09_План_разработки.md:47) — Alpha deliverables: "30+ уровней"
- [`09_План_разработки.md:59`](Docs/Plan/09_План_разработки.md:59) — Beta: "60-80 уровней с кривой сложности"

**Анализ:**
План содержит три различных целевых показателя количества уровней на релиз: 100 уровней (в roadmap), 80 уровней (рекомендация в документе о прогрессии) и 60-100 уровней (вариативный диапазон). Это создаёт неопределённость в планировании ресурсов и оценке объёма работы. Более того, указанные 80 уровней для Beta-версии противоречат заявлению о 100 уровнях для Global Launch, если не предполагать разработку дополнительных 20 уровней в короткий промежуток между Beta и Global Launch.

**Рекомендация:**
Унифицировать целевой показатель до конкретного значения. Рекомендуется выбрать 80 уровней как баланс между контентом и реалистичными сроками разработки. Внести соответствующие изменения в [`09_План_разработки.md:99`](Docs/Plan/09_План_разработки.md:99) и [`01_Концепция_и_видение.md:101`](Docs/Plan/01_Концепция_и_видение.md:101).

### 1.2. Несоответствие в распределении уровней по сложности

**Расположение противоречия:**
- [`05_Прогрессия_и_сложность.md:66-73`](Docs/Plan/05_Прогрессия_и_сложность.md:66-73) — Детальная разбивка уровней по сложности
- [`05_Прогрессия_и_сложность.md:87-94`](Docs/Plan/05_Прогрессия_и_сложность.md:87-94) — Таблица параметров сложности по уровням прогрессии

**Анализ:**
Документ о прогрессии содержит детальную таблицу распределения уровней по сложности, где Hard Levels начинаются с 61 уровня и выше. Однако в roadmap указано 100 уровней на релиз, что означает необходимость создания 40+ уровней категории Hard и Expert. При целевом Win Rate 20-40% для Expert уровней это потребует значительных усилий по балансировке, которые не учтены в плане разработки.

**Рекомендация:**
Добавить в [`09_План_разработки.md`](Docs/Plan/09_План_разработки.md) отдельный этап или подзадачи по созданию контента для высокоуровневых сложных уровней с указанием требуемых ресурсов на балансировку.

---

## 2. Противоречия в технических требованиях

### 2.1. Конфликт между производительностью и сложностью уровней

**Расположение противоречия:**
- [`10_Технические_требования.md:40`](Docs/Plan/10_Технические_требования.md:40) — "FPS target: 60 FPS на средних устройствах"
- [`10_Технические_требования.md:42`](Docs/Plan/10_Технические_требования.md:42) — "RAM usage: < 300 MB"
- [`05_Прогрессия_и_сложность.md:93`](Docs/Plan/05_Прогрессия_и_сложность.md:93) — "Уровни 61-80: 6-7 типов элементов, 40-60% плотность препятствий"
- [`05_Прогрессия_и_сложность.md:94`](Docs/Plan/05_Прогрессия_и_сложность.md:94) — "Уровни 81+: 50-70% плотность препятствий, Spawners"

**Анализ:**
План устанавливает жёсткие ограничения по производительности (60 FPS, <300 MB RAM) при одновременном увеличении сложности уровней к концу игры. Высокая плотность препятствий, множественные типы элементов и наличие Spawners создают повышенную нагрузку на систему. BFS-алгоритм для match detection, указанный в [`03_Алгоритмы_и_системы.md:67`](Docs/Plan/03_Алгоритмы_и_системы.md:67), имеет квадратичную сложность O(n²) в худшем случае, что может создавать проблемы на больших сетках с высокой плотностью элементов.

**Рекомендация:**
1. Добавить в [`03_Алгоритмы_и_системы.md`](Docs/Plan/03_Алгоритмы_и_системы.md) раздел по оптимизации BFS с использованием dirty regions и early exit оптимизаций
2. Рассмотреть возможность кэширования результатов проверки соседних элементов
3. Добавить в план этап профилирования производительности на устройствах нижнего ценового сегмента

### 2.2. Противоречие в требованиях к отсутствию сторонних плагинов

**Расположение противоречия:**
- [`10_Технические_требования.md:44-48`](Docs/Plan/10_Технические_требования.md:44-48) — "Без сторонних плагинов"
- [`09_План_разработки.md:85`](Docs/Plan/09_План_разработки.md:85) — "Интеграция аналитики (Unity Analytics / Firebase)"
- [`01_Концепция_и_видение.md:82`](Docs/Plan/01_Концепция_и_видение.md:82) — "Работа без сторонних плагинов"

**Анализ:**
План декларирует отсутствие сторонних плагинов как ключевое ограничение, но при этом предполагает использование Firebase и Unity Analytics. Firebase является SDK Google, а не сторонним плагином в узком смысле, однако его интеграция требует дополнительных библиотек и настройки, что противоречит духу ограничения "чистого" Unity-проекта. Кроме того, Unity Analytics также требует специфической настройки и может считаться внешним сервисом.

**Рекомендация:**
Чётко определить, что подразумевается под "сторонними плагинами":
- Если допускается использование официальных SDK (Firebase, Unity Services), это необходимо явно указать
- Если требуется полная автономность, заменить Firebase на локальное хранение данных с периодической отправкой на собственный сервер

---

## 3. Противоречия в системе балансировки

### 3.1. Логическая ошибка в формуле Win Rate

**Расположение противоречия:**
- [`05_Прогрессия_и_сложность.md:129-141`](Docs/Plan/05_Прогрессия_и_сложность.md:129-141) — Формулы Win Rate

**Анализ:**
Документ описывает две различные методологии расчёта Win Rate, которые могут противоречить друг другу:
1. Эмпирические целевые показатели: Easy 80-90%, Medium 60-70%, Hard 30-50%, Expert 20-40%
2. Формула симуляции: "Simulated_WinRate = successful_runs / total_simulation_runs, где total_simulation_runs = 100"

Проблема заключается в том, что симуляция с 100 запусков даёт статистически неточные результаты для целевых показателей в диапазоне 20-50%. При 100 запусках погрешность составляет ±10%, что делает невозможным точную настройку баланса.

**Рекомендация:**
Увеличить количество симуляций до 1000+ для статистически значимых результатов. Добавить доверительные интервалы к формуле Win Rate.

### 3.2. Противоречие в параметрах сложности

**Расположение противоречия:**
- [`05_Прогрессия_и_сложность.md:50-56`](Docs/Plan/05_Прогрессия_и_сложность.md:50-56) — Формула Difficulty_score
- [`05_Прогрессия_и_сложность.md:59-62`](Docs/Plan/05_Прогрессия_и_сложность.md:59-62) — Диапазоны сложности

**Анализ:**
Формула Difficulty_score = (element_types × 10) + (100 / move_count) + (obstacle_density × 50) + (obstacle_complexity × 15) + (target_difficulty × 20) создаёт несбалансированное влияние параметров:
- При max значениях: (7×10) + (100/12) + (1×50) + (2×15) + (20×20) = 70 + 8.3 + 50 + 30 + 400 = 558.3
- Это значительно превышает заявленный диапазон Expert: 151+

Формула математически некорректна и требует нормализации коэффициентов.

**Рекомендация:**
Пересмотреть формулу с учётом нормализованных весов:
```
Difficulty_score = 
    (element_types_normalized × w1) +
    (move_count_normalized × w2) +
    (obstacle_density × w3) +
    (obstacle_complexity × w4) +
    (target_difficulty × w5)
```

---

## 4. Противоречия в плане разработки по этапам

### 4.1. Перегруженность Alpha-этапа

**Расположение противоречия:**
- [`09_План_разработки.md:27-46`](Docs/Plan/09_План_разработки.md:27-46) — Production - Alpha

**Анализ:**
Alpha-этап включает следующий объём задач:
- Все типы бустеров + комбинации
- Все типы препятствий
- State Machine для игры
- 4 типа уровней (Collection, Clear, Drop, Score)
- Система звёзд и очков
- Level Editor
- Shuffle система + Hint
- Интеграция графики
- Базовый аудио

При этом Alpha должна включать 30-40 уровней. Создание Level Editor параллельно с разработкой основных механик создаёт зависимость: Level Editor необходим для создания контента, но его разработка требует стабильной базовой системы.

**Рекомендация:**
Разделить Alpha на две подфазы:
- Alpha 1: Базовые механики + 15-20 уровней (ручная настройка)
- Alpha 2: Level Editor + оставшиеся уровни

### 4.2. Отсутствие этапа Vertical Slice

**Расположение противоречия:**
- [`09_План_разработки.md:10-26`](Docs/Plan/09_План_разработки.md:10-26) — Pre-production

**Анализ:**
Pre-production включает создание прототипа с "простейшим уровнем (8×8, без препятствий)" и placeholder графикой. Однако отсутствует явный этап Vertical Slice — полностью полированного уровня с финальной графикой и звуком, который служит эталоном качества для остальной разработки.

**Рекомендация:**
Добавить после Pre-production этап "Vertical Slice" с созданием 1-2 полностью готовых уровней, которые будут использоваться как:
- Технический и визуальный эталон
- Тестовый полигон для новых механик
- Базовые уровни для демонстрации инвесторам/партнёрам

### 4.3. Пропуск этапа Quality Assurance (QA) Integration

**Расположение противоречия:**
- [`09_План_разработки.md:48-67`](Docs/Plan/09_План_разработки.md:48-67) — Production - Beta

**Анализ:**
Beta-этап включает "Bug fixing" и "Оптимизация производительности", но отсутствует системный подход к QA:
- Не указаны автоматизированные тесты
- Не определены метрики качества (critical bugs threshold)
- Не указано использование тестовых фреймворков

**Рекомендация:**
Добавить в Beta-этап подзадачи:
- Unit tests для core механик (Grid, Match detection)
- Integration tests для State Machine
- Acceptance criteria для release readiness

---

## 5. Противоречия в системе анимаций и таймингов

### 5.1. Несоответствие суммарного времени анимаций

**Расположение противоречия:**
- [`04_Техническая_специфика.md:65-88`](Docs/Plan/04_Техническая_специфика.md:65-88) — Timing и порядок операций

**Анализ:**
Указанные тайминги для одной итерации хода:
- SwapAnimation: 0.3s
- Destroying: 0.4s
- Falling: 0.5s
- Spawning: 0.3s
- CascadeCheck: 0.1s

Суммарное время одной каскадной итерации: 1.6 секунды без учёта задержек между анимациями. При наличии каскадов (до 5-10+ в сложных уровнях) общее время может достигать 16+ секунд仅 на одну цепочку совпадений, что противоречит заявлению в [`01_Концепция_и_видение.md:39`](Docs/Plan/01_Концепция_и_видение.md:39) о "более быстром геймплее (меньше ожиданий анимаций)".

**Рекомендация:**
1. Добавить возможность ускорения каскадных анимаций (dynamic speedup)
2. Ввести максимальное время на каскадные цепочки
3. Рассмотреть пропуск некоторых анимаций при множественных каскадах

### 5.2. Отсутствие обработки edge cases в State Machine

**Расположение противоречия:**
- [`04_Техническая_специфика.md:12-32`](Docs/Plan/04_Техническая_специфика.md:12-32) — Game State Machine

**Анализ:**
State Machine содержит основные состояния, но не учитывает:
- Одновременную активацию нескольких бустеров
- Chain reactions между бустерами
- Deadlock detection во время анимаций
- Сохранение состояния при прерывании (например, выход в меню)

**Рекомендация:**
Расширить State Machine:
```csharp
public enum GameState
{
    // ... существующие состояния ...
    BoosterActivation,      // Одновременная активация бустеров
    ChainReaction,         // Цепочка реакций
    SavingState,           // Экстренное сохранение
    InterruptHandler       // Обработка прерываний
}
```

---

## 6. Противоречия в системе сохранения и данных

### 6.1. Конфликт между ScriptableObject и JSON

**Расположение противоречия:**
- [`05_Прогрессия_и_сложность.md:15-17`](Docs/Plan/05_Прогрессия_и_сложность.md:15-17) — Формат хранения уровней
- [`10_Технические_требования.md:21`](Docs/Plan/10_Технические_требования.md:21) — ScriptableObjects/Levels/

**Анализ:**
Документ предлагает два формата хранения:
- ScriptableObject (Unity-native)
- JSON файлы (для hot-reload)

Однако план разработки не содержит задач по реализации JSON-системы, а только упоминает ScriptableObjects. Это создаёт неопределённость в выборе формата для production.

**Рекомендация:**
Выбрать ScriptableObject как основной формат для редактора и добавить экспорт в JSON как вспомогательную функцию для backup и transfer.

### 6.2. Отсутствие системы сохранения прогресса игрока

**Расположение противоречия:**
- [`06_UI_UX.md:79`](Docs/Plan/06_UI_UX.md:79) — "Автосохранение прогресса"
- Отсутствует раздел о системе сохранений в других документах

**Анализ:**
План упоминает автосохранение прогресса, но детальная спецификация системы сохранений отсутствует:
- Не указаны данные для сохранения (прогресс уровней, звёзды, валюта)
- Не указаны триггеры сохранения
- Не указано хранение данных (PlayerPrefs, JSON, бинарный формат)
- Не указана обработка конфликтов и backup

**Рекомендация:**
Добавить раздел "Система сохранений" в [`10_Технические_требования.md`](Docs/Plan/10_Технические_требования.md) с описанием:
- Data schema для прогресса игрока
- Storage mechanism (рекомендуется JSON в persistentDataPath)
- Cloud save sync (опционально)

---

## 7. Противоречия в художественном оформлении и аудио

### 7.1. Несоответствие источников ассетов

**Расположение противоречия:**
- [`07_Художественный_стиль.md:30-31`](Docs/Plan/07_Художественный_стиль.md:30-31) — Источники визуальных референсов
- [`07_Художественный_стиль.md:44-46`](Docs/Plan/07_Художественный_стиль.md:44-46) — Источники игровых элементов

**Анализ:**
План предлагает использовать ассеты из различных источников:
- Kenney.nl — CC0 License
- Freepik — Free License (с атрибуцией)
- Itch.io — различные лицензии

Смешивание ассетов с разными лицензиями и визуальными стилями создаёт риск:
- Нарушение авторских прав при неправильном атрибутировании
- Визуальная несогласованность итогового продукта
- Сложность масштабирования и модификации

**Рекомендация:**
1. Ограничить использование ассетов одним источником с единой лицензией (рекомендуется Kenney.nl CC0)
2. Либо создать собственную минимальную графику, либо заказать уникальный art kit

### 7.2. Отсутствие согласования аудио с этапами разработки

**Расположение противоречия:**
- [`09_План_разработки.md:42`](Docs/Plan/09_План_разработки.md:42) — Alpha: "Базовый аудио"
- [`09_План_разработки.md:57`](Docs/Plan/09_План_разработки.md:57) — Beta: "Полный аудио (музыка + SFX)"

**Анализ:**
План не детализирует, что входит в "базовое аудио" и что добавляется в "полное аудио". Это создаёт риск недостаточного объёма аудио-контента на Alpha и избыточного — на Beta.

**Рекомендация:**
Добавить детализацию:
- Alpha: базовые SFX для матчей, UI звуки (click, select)
- Beta: полный набор SFX, 2-3 варианта фоновой музыки для эпизодов, victory/failure jingles

---

## 8. Противоречия в Live Ops планировании

### 8.1. Несоответствие ресурсов амбициям Post-Launch

**Расположение противоречия:**
- [`09_План_разработки.md:102-154`](Docs/Plan/09_План_разработки.md:102-154) — Post-Launch (Live Ops)

**Анализ:**
Post-Launch план включает:
- Месяц 1-2: Стабилизация, багфиксы, новые уровни
- Месяц 3-4: События, сезонный контент
- Месяц 5-6: Новая мета-механика (строительство города)
- Месяц 7+: PvP, кланы, социальные фичи

Проблема: PvP, кланы и строительство города требуют:
- Backend-инфраструктуры (не учтено в ограничениях "без сторонних плагинов")
- Значительного расширения команды
- Другого уровня монетизации и retention механик

**Рекомендация:**
1. Отложить PvP и кланы до отдельного этапа с явным указанием требований к инфраструктуре
2. Сосредоточить Месяцы 5-6 на расширении core gameplay (новые типы уровней, бустеры)
3. Добавить технические требования для серверной части

---

## 9. Противоречия в организационных аспектах

### 9.1. Отсутствие явного распределения ответственности

**Расположение противоречия:**
- [`10_Технические_требования.md:88`](Docs/Plan/10_Технические_требования.md:88) — "Ответственный: Game Designer / Programmer"

**Анализ:**
План указывает единственного ответственного (Game Designer / Programmer), что подходит для соло-разработки, но противоречит масштабу задач:
- Разработка полноценной Match-3 игры с 80+ уровнями
- Создание Level Editor
- Интеграция графики и аудио
- Тестирование и балансировка
- Маркетинг и community management

**Рекомендация:**
Скорректировать план с учётом реалистичных ресурсов:
- Либо уменьшить scope (количество уровней, функций)
- Либо明确 распределить задачи при найме дополнительных членов команды
- Добавить timeline с зависимостями между задачами

### 9.2. Отсутствие метрик оценки прогресса

**Расположение противоречия:**
- [`09_План_разработки.md`](Docs/Plan/09_План_разработки.md) — Полностью отсутствуют критерии перехода между этапами

**Анализ:**
План описывает цели каждого этапа, но не содержит:
- Definition of Done (DoD) для каждого этапа
- Acceptance criteria для deliverables
- Milestone reviews

**Рекомендация:**
Добавить таблицу критериев перехода:

| Этап | Критерий перехода |
|------|-------------------|
| Pre-production → Alpha | 100% fun factor confirmed, playable prototype |
| Alpha → Beta | 30+ levels playable, core mechanics stable |
| Beta → Soft Launch | 80 levels, <10 critical bugs, 60 FPS achieved |
| Soft Launch → Global Launch | D1 retention >30%, win rate targets met |

---

## 10. Сводная таблица выявленных противоречий

| № | Категория | Критичность | Требуемое действие |
|---|-----------|-------------|-------------------|
| 1 | Количество уровней | Высокая | Унифицировать до 80 уровней |
| 2 | Win Rate формула | Средняя | Увеличить симуляции до 1000+ |
| 3 | Производительность vs сложность | Высокая | Добавить этап профилирования |
| 4 | Сторонние плагины | Средняя | Уточнить определение ограничения |
| 5 | Alpha перегруженность | Высокая | Разделить на Alpha 1/2 |
| 6 | Отсутствие Vertical Slice | Средняя | Добавить этап |
| 7 | QA Integration | Высокая | Добавить тестовые задачи |
| 8 | Анимации тайминги | Средняя | Добавить dynamic speedup |
| 9 | State Machine | Средняя | Расширить состояния |
| 10 | Система сохранений | Высокая | Добавить спецификацию |
| 11 | Ассеты лицензии | Средняя | Выбрать единый источник |
| 12 | Live Ops амбиции | Высокая | Скорректировать roadmap |
| 13 | Распределение ответственности | Средняя | Уточнить ресурсы |
| 14 | Критерии перехода | Высокая | Добавить DoD |

---

## Заключение

План разработки Match-3 игры представляет собой комплексный документ с детальной проработкой механик, систем и контента. Однако выявленные противоречия требуют внимания перед началом активной фазы разработки.

**Приоритетные действия для устранения критических противоречий:**

1. **Немедленно:** Унифицировать количество уровней на релиз (рекомендация: 80)
2. **Немедленно:** Добавить этап Vertical Slice после Pre-production
3. **Перед Alpha:** Разделить Alpha на две подфазы, перенеся Level Editor во вторую
4. **Перед Beta:** Добавить систему автоматизированных тестов
5. **Перед Soft Launch:** Уточнить требования к серверной инфраструктуре для Live Ops

После устранения указанных противоречий план станет более реалистичным и выполнимым, что повысит шансы успешного завершения проекта в запланированные сроки.
