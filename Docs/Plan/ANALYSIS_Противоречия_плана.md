# Детальный анализ плана разработки Match-3 игры

## Введение

Данный документ представляет собой комплексный анализ плана разработки Match-3 игры для платформы Android на движке Unity 2022.3.62f3. Анализ охватывает все ключевые аспекты плана: цели и задачи, временные рамки, распределение ресурсов, зависимости между элементами и потенциальные риски реализации.

---

## 0. Фундаментальные ограничения проекта

### 0.1. Сторонние плагины — НЕДОПУСТИМО

**Определение:**
> **Сторонние плагины** — любые внешние библиотеки, SDK, фреймворки или инструменты, не входящие в стандартную поставку Unity 2022.3.62f3 и не являющиеся частью официального Unity Engine API.

**Полный запрет распространяется на:**
- Firebase (все продукты: Analytics, Crashlytics, Remote Config, Auth, Firestore)
- Unity Analytics, Unity Remote Config, Unity Cloud Build
- PlayFab, Photon, Mirror, Bolt (networking)
- DOTween, LeanTween, iTween (анимации)
- PlayMaker, Behavior Designer (AI/behavior)
- AdMob, Unity Ads, ironSource (монетизация)
- Amplitude, Mixpanel, Adjust (аналитика)
- Easy Save, Odin Serializer (сериализация)
- Любые Asset Store ассеты, требующие integration

**Разрешённые технологии:**
- Unity Engine API (MonoBehaviour, ScriptableObject, Coroutines)
- C# .NET Standard 2.1 (базовые библиотеки)
- Unity PlayerPrefs (сохранение данных)
- JSON сериализация через JsonUtility или System.Text.Json

**Последствия нарушения:**
- Отказ от merge/pull request
- Удаление кода при code review
- Пересмотр архитектуры решения

### 0.2. Аналитика — НЕ ТРЕБУЕТСЯ

**Нет внешней аналитики**
**Нет локальной аналитики**

Отсутствует необходимость в сборе метрик пользователей:
- Нет требований к отслеживанию Retention (D1, D7, D30)
- Нет требований к session length метрикам
- Нет требований к A/B тестированию
- Нет требований к сбору данных о churn points

Все системы аналитики удалены из плана разработки.

### 0.3. Серверная инфраструктура — НЕ ТРЕБУЕТСЯ

**Все системы работают локально:**
- Сохранение прогресса: PlayerPrefs + JSON
- Аналитика: локальные метрики с логированием
- Балансировка: встроенные таблицы и AI-симулятор
- Социальные функции: не поддерживаются (Friend lists, clans, PvP)

---

## 1. Противоречия в количественных показателях уровней

### 1.1. Несоответствие целевого количества уровней — ИСПРАВЛЕНО

**Расположение противоречия:**
- [`09_План_разработки.md:99`](Docs/Plan/09_План_разработки.md:99) — Roadmap указывает "Global Launch: ✅ 100 уровней"
- [`05_Прогрессия_и_сложность.md:11`](Docs/Plan/05_Прогрессия_и_сложность.md:11) — "На релиз: 60-100 уровней (рекомендация: 80)"
- [`09_План_разработки.md:47`](Docs/Plan/09_План_разработки.md:47) — Alpha deliverables: "30+ уровней"
- [`09_План_разработки.md:59`](Docs/Plan/09_План_разработки.md:59) — Beta: "60-80 уровней с кривой сложности"

**Анализ:**
План содержит три различных целевых показателя количества уровней на релиз: 100 уровней (в roadmap), 80 уровней (рекомендация в документе о прогрессии) и 60-100 уровней (вариативный диапазон). Это создаёт неопределённость в планировании ресурсов и оценке объёма работы.

**РЕШЕНИЕ — УНИФИКАЦИЯ КОЛИЧЕСТВА УРОВНЕЙ:**

**Global Launch: 80 уровней**

| Этап | Количество уровней | Структура |
|------|-------------------|-----------|
| Pre-production | 3-5 уровней | Тестовые уровни |
| Alpha | 30+ уровней | Полное покрытие механик |
| Beta | 70-80 уровней | Финальная кривая сложности |
| Global Launch | 80 уровней | 4 эпизода по 20 уровней |

**Структура эпизодов:**
```
Эпизод 1: Уровни 1-20 (Easy → Medium)
Эпизод 2: Уровни 21-40 (Medium)
Эпизод 3: Уровни 41-60 (Medium → Hard)
Эпизод 4: Уровни 61-80 (Hard + Expert)
```

### 1.2. Система управления уровнями — ScriptableObject

**Принятое решение:** Полностью ScriptableObject-базированная система.

```csharp
// Основной ScriptableObject для уровня
[CreateAssetMenu(fileName = "Level_XXX", menuName = "Match3/Level")]
public class LevelData : ScriptableObject
{
    [Header("Basic Info")]
    public int levelNumber;
    public string levelID;
    public LevelType levelType;
    
    [Header("Grid Configuration")]
    public int width = 8;
    public int height = 8;
    public GridShape shape = GridShape.Rectangle;
    public bool[,] customCells;
    
    [Header("Objectives")]
    public Objective[] objectives;
    public int movesAllowed;
    public int[] starThresholds = new int[3];
    
    [Header("Elements & Obstacles")]
    public ElementType[] allowedElements;
    public ElementWeights elementWeights;
    public ObstacleSpawnData[] obstacles;
    
    [Header("Metadata")]
    public bool isHardLevel;
    public bool isTutorialLevel;
    public Sprite previewImage;
}

// Эпизод - контейнер для уровней
[CreateAssetMenu(fileName = "Episode_XXX", menuName = "Match3/Episode")]
public class EpisodeData : ScriptableObject
{
    public int episodeNumber;
    public string episodeName;
    public Sprite backgroundImage;
    public List<LevelData> levels = new List<LevelData>();
}
```

**LevelManager — централизованное управление:**

```csharp
public class LevelManager : MonoBehaviour
{
    [Header("Configuration")]
    [SerializeField] private List<EpisodeData> episodes = new List<EpisodeData>();
    
    // Автоматическая генерация списка уровней при старте
    private void Awake()
    {
        GenerateLevelIndex();
        ValidateAllLevels();
    }
    
    // Загрузка уровня по индексу
    public LevelData GetLevelByIndex(int globalIndex)
    {
        if (globalIndex < 0 || globalIndex >= levelIndex.Count)
        {
            Debug.LogError($"Level index {globalIndex} out of range");
            return null;
        }
        return levelIndex[globalIndex];
    }
    
    // Загрузка уровня по ID
    public LevelData GetLevelByID(string levelID)
    {
        if (levelDictionary.TryGetValue(levelID, out LevelData level))
            return level;
        return null;
    }
    
    // Валидация данных уровня при загрузке
    private void ValidateLevel(LevelData level)
    {
        Debug.Assert(level.width >= 4 && level.width <= 12, "Invalid width");
        Debug.Assert(level.height >= 4 && level.height <= 12, "Invalid height");
        Debug.Assert(level.movesAllowed > 0, "Moves must be positive");
        Debug.Assert(level.starThresholds.Length == 3, "Must have 3 star thresholds");
        ValidateObstaclesAgainstGrid(level);
    }
}
```

**Кастомный инспектор для Unity Editor:**

```csharp
#if UNITY_EDITOR
[CustomEditor(typeof(LevelData))]
public class LevelDataEditor : UnityEditor.Editor
{
    public override void OnInspectorGUI()
    {
        LevelData level = (LevelData)target;
        DrawDefaultInspector();
        
        EditorGUILayout.Space(10);
        EditorGUILayout.LabelField("Statistics", EditorStyles.boldLabel);
        EditorGUILayout.LabelField($"Objectives: {level.objectives.Length}");
        EditorGUILayout.LabelField($"Obstacles: {level.obstacles.Length}");
        
        if (GUILayout.Button("Validate"))
            ValidateLevelData(level);
    }
}
#endif
```

**Особенности системы:**
- Все данные уровней хранятся в ассетах проекта
- Добавление новых уровней требует пересборки билда
- Централизованное управление через LevelManager
- Валидация данных при загрузке уровня

---

## 2. Противоречия в технических требованиях

### 2.1. Сторонние плагины — УДАЛЕНЫ

**Было:**
- [`10_Технические_требования.md:44-48`](Docs/Plan/10_Технические_требования.md:44-48) — "Без сторонних плагинов" + Firebase
- [`09_План_разработки.md:85`](Docs/Plan/09_План_разработки.md:85) — "Интеграция аналитики (Unity Analytics / Firebase)"

**Стало:**
Firebase и Unity Analytics полностью удалены из требований.

### 2.2. Конфликт между производительностью и сложностью уровней

**Расположение противоречия:**
- [`10_Технические_требования.md:40`](Docs/Plan/10_Технические_требования.md:40) — "FPS target: 60 FPS на средних устройствах"
- [`05_Прогрессия_и_сложность.md:93`](Docs/Plan/05_Прогрессия_и_сложность.md:93) — "Уровни 61-80: 6-7 типов элементов, 40-60% плотность препятствий"

**Рекомендация:**
Добавить раздел по оптимизации BFS и этап профилирования производительности.

---

## 3. НОВЫЕ ВЫЯВЛЕННЫЕ ПРОТИВОРЕЧИЯ

### 3.1. Противоречие: JSON пример в технических требованиях vs ScriptableObject-only

**Расположение противоречия:**
- [`10_Технические_требования.md:75-93`](Docs/Plan/10_Технические_требования.md:75-93) — JSON пример конфигурации уровня
- [`05_Прогрессия_и_сложность.md:21-22`](Docs/Plan/05_Прогрессия_и_сложность.md:21-22) — "Unity-native: ScriptableObject"
- [`10_Технические_требования.md:58`](Docs/Plan/10_Технические_требования.md:58) — "PlayerPrefs + JSON (сохранение данных)"

**Анализ:**
Документ 10_Технические_требования.md содержит JSON-пример уровня (строки 75-93), что подразумевает использование JSON для хранения уровней. Однако план предусматривает использование только ScriptableObject без Asset Bundle и DLC. JSON-сериализация разрешена только для сохранения прогресса игрока (PlayerPrefs), а не для хранения уровней.

**РЕШЕНИЕ:**
Удалить JSON-пример уровня из технических требований. Привести раздел к виду:
```
// УДАЛЕН: JSON-пример конфигурации уровня
// Вместо этого используется ScriptableObject (см. раздел 3.1.2)
```

---

### 3.2. Противоречие: Soft Launch упоминает сбор метрик, но аналитика запрещена

**Расположение противоречия:**
- [`09_План_разработки.md:71`](Docs/Plan/09_План_разработки.md:71) — "Сбор метрик"
- [`ANALYSIS_Противоречия_плана.md:38-49`](Docs/Plan/ANALYSIS_Противоречия_плана.md:38-49) — "Аналитика — НЕ ТРЕБУЕТСЯ"

**Анализ:**
В 09_План_разработки.md цели Soft Launch включают "Сбор метрик", однако фундаментальное ограничение проекта гласит, что аналитика НЕ ТРЕБУЕТСЯ. Это создаёт неопределённость: что именно подразумевается под "сбором метрик" — внешние сервисы (запрещены) или внутреннее логирование (разрешено, но также объявлено как НЕ ТРЕБУЕТСЯ)?

**РЕШЕНИЕ:**
Изменить цели Soft Launch:

**БЫЛО:**
- Тестирование на реальных пользователях
- Сбор метрик
- Быстрые итерации

**СТАЛО:**
- Тестирование на реальных пользователях
- Внутреннее тестирование стабильности
- Bug fixing на основе обратной связи

---

### 3.3. Противоречие: Roadmap Soft Launch упоминает аналитику и A/B тестирование

**Расположение противоречия:**
- [`09_План_разработки.md:132-135`](Docs/Plan/09_План_разработки.md:132-135) —
```
Soft Launch:
- ✅ Аналитика
- ✅ A/B тестирование
- ✅ Корректировки баланса
```
- [`ANALYSIS_Противоречия_плана.md:38-49`](Docs/Plan/ANALYSIS_Противоречия_плана.md:38-49) — "Аналитика — НЕ ТРЕБУЕТСЯ"

**РЕШЕНИЕ:**
Удалить пункты "Аналитика" и "A/B тестирование" из Roadmap Soft Launch:

**БЫЛО:**
```
Soft Launch:
- ✅ Аналитика
- ✅ A/B тестирование
- ✅ Корректировки баланса
```

**СТАЛО:**
```
Soft Launch:
- ❌ Аналитика [УДАЛЕНО - запрещено]
- ❌ A/B тестирование [УДАЛЕНО - требует серверов]
- ✅ Корректировки баланса
```

---

### 3.4. Противоречие: Post-Launch упоминает PvP и кланы, но серверная инфраструктура запрещена

**Расположение противоречия:**
- [`09_План_разработки.md:104`](Docs/Plan/09_План_разработки.md:104) — "Новые фичи (например, PvP, кланы)"
- [`ANALYSIS_Противоречия_плана.md:51-58`](Docs/Plan/ANALYSIS_Противоречия_плана.md:51-58) — "Серверная инфраструктура — НЕ ТРЕБУЕТСЯ"
- Фундаментальное ограничение: "Социальные функции: не поддерживаются (Friend lists, clans, PvP)"

**Анализ:**
PvP и кланы требуют серверной инфраструктуры для:
- Синхронизации данных между игроками
- Рейтинговой системы
- Чатов и сообщений
- Временных событий с синхронизацией

Эти функции заявлены в Post-Launch, но противоречат фундаментальному ограничению "Без серверной инфраструктуры".

**РЕШЕНИЕ:**
Удалить PvP и кланы из Post-Launch плана. Заменить на локальные функции:

**БЫЛО:**
- Новые уровни
- События (временные челленджи)
- Сезонный контент (праздники)
- Баланс-патчи
- Новые фичи (например, PvP, кланы) ← УДАЛИТЬ

**СТАЛО:**
- Новые уровни
- События (временные челленджи) ← только локальные
- Сезонный контент (праздники)
- Баланс-патчи
- Новые локальные фичи (новые типы препятствий, бустеров)

---

## 4. НЕРЕШЁННЫЕ ПРОБЛЕМЫ

### 4.1. Win Rate формула — недостаточное количество симуляций

**Расположение:**
- [`05_Прогрессия_и_сложность.md:174`](Docs/Plan/05_Прогрессия_и_сложность.md:174) — "total_simulation_runs = 100"

**Проблема:**
При 100 симуляциях статистическая погрешность составляет ±9.8% (при 95% доверительном интервале). Для надёжной балансировки рекомендуется не менее 1000 симуляций.

**РЕШЕНИЕ:**
**БЫЛО:**
```
total_simulation_runs = 100
```

**СТАЛО:**
```
total_simulation_runs = 1000 (минимум)
Рекомендуемое: 5000+ для финальной балансировки
```

---

### 4.2. Alpha этап перегружен — Level Editor слишком амбициозен

**Расположение:**
- [`09_План_разработки.md:39`](Docs/Plan/09_План_разработки.md:39) — "Level Editor (инструмент для создания уровней)"

**Проблема:**
Level Editor — это отдельный сложный инструмент, требующий:
- UI/UX проектирования
- Сериализации/десериализации
- Валидации уровней
- Экспорта в ScriptableObject
- Тестирования

Включение его в Alpha создаёт риски:
- Затягивание сроков Alpha
- Переключение внимания с core gameplay
- Технический долг

**РЕШЕНИЕ:**
Перенести Level Editor в Beta этап:

**БЫЛО:**
```
Alpha (30-40 уровней):
- ✅ Все бустеры + комбинации
- ✅ Все типы препятствий
- ✅ Level Editor (инструмент для создания уровней)
```

**СТАЛО:**
```
Alpha (30-40 уровней):
- ✅ Все бустеры + комбинации
- ✅ Все типы препятствий
- ❌ Level Editor [ПЕРЕНЕСЕН В BETA]

Beta:
- ✅ Level Editor (инструмент для создания уровней)
```

**АЛЬТЕРНАТИВА:**
Удалить Level Editor из MVP и создавать уровни вручную через Inspector до выхода Beta.

---

### 4.3. Отсутствует этап Vertical Slice

**Проблема:**
План переходит от Pre-production с 3-5 уровнями сразу к Alpha с 30+ уровнями. Это пропускает важный этап — создание 1-2 полностью полированных уровней (Vertical Slice) как референса качества.

**РЕШЕНИЕ:**
Добавить этап Vertical Slice после Pre-production:

```markdown
#### 7.1.X. Production - Vertical Slice

**Цели:**
- Создание 1-2 референсных уровней
- Финализация визуального стиля
- Финализация аудио
- Определение стандартов качества

**Задачи:**
- [ ] 1-2 полностью полированных уровня
- [ ] Финальная графика и анимации
- [ ] Полный аудио для уровней
- [ ] UI/UX для игрового процесса
- [ ] Документация стандартов уровней

**Deliverables:**
- Vertical Slice build
- Согласованные стандарты качества
```

---

### 4.4. Производительность — отсутствует этап профилирования

**Проблема:**
План упоминает "Оптимизация производительности (60 FPS)" в Beta, но:
- Отсутствует методология профилирования
- Отсутствуют метрики для BFS
- Отсутствует план оптимизации

**РЕШЕНИЕ:**
Добавить раздел по оптимизации в план разработки:

```markdown
#### B.1. Оптимизация BFS алгоритма

**Текущая сложность:** O(V + E) на поиск матча
**Узкие места:**
- Множественные вызовы BFS при каскадах
- Аллоцирование новых списков при каждом поиске

**Оптимизации:**
1. Object Pooling для списков
2. Кэширование графа сетки
3. Оптимизированные структуры данных
4. Ранний выход при отсутствии матчей

#### B.2. Этап профилирования

**Инструменты:**
- Unity Profiler
- Memory Profiler
- Frame Debugger

**Метрики:**
- FPS: 60 на средних устройствах
- Memory: < 300 MB
- Load time: < 3 секунды
- GC per frame: < 2 KB
```

---

## 5. Сводная таблица решений (ОБНОВЛЁННАЯ)

| № | Проблема | Решение | Статус |
|---|----------|---------|--------|
| 1 | Количество уровней | 80 уровней, ScriptableObject | ✅ Готово |
| 2 | Сторонние плагины | Полный запрет | ✅ Готово |
| 3 | Firebase/Analytics | Удалены, сбор метрик запрещён | ✅ Готово |
| 4 | JSON пример уровня | Удалить из Tech Reqs | ❌ Не исправлено |
| 5 | Soft Launch метрики | Удалить "Сбор метрик" | ❌ Не исправлено |
| 6 | Roadmap Soft Launch | Удалить Analytics/A/B | ❌ Не исправлено |
| 7 | Post-Launch PvP/кланы | Удалить, добавить локальные фичи | ❌ Не исправлено |
| 8 | Win Rate симуляции | 100 → 1000+ | ⏳ Требует решения |
| 9 | Alpha перегружен | Level Editor в Beta | ⏳ Требует решения |
| 10 | Нет Vertical Slice | Добавить этап | ⏳ Требует решения |
| 11 | Нет профилирования | Добавить раздел оптимизации | ⏳ Требует решения |

---

## Заключение

**Фундаментальные ограничения:**
1. ❌ Сторонние плагины — НЕДОПУСТИМО
2. ❌ IAP/Реклама — НЕ ПЛАНИРУЕТСЯ
3. ❌ Серверная инфраструктура — НЕ ТРЕБУЕТСЯ
4. ❌ Аналитика — НЕ ТРЕБУЕТСЯ

**Архитектура:**
- 80 уровней на Global Launch
- ScriptableObject для всех данных уровней
- LevelManager для централизованного управления
- PlayerPrefs + JSON для сохранения прогресса
- Локальные фичи только (без PvP, кланов, социальных функций)

**Требуемые исправления:**
1. Удалить JSON-пример из 10_Технические_требования.md
2. Удалить "Сбор метрик" из целей Soft Launch
3. Удалить Analytics/A/B из Roadmap Soft Launch
4. Удалить PvP/кланы из Post-Launch
5. Увеличить Win Rate симуляции до 1000+
6. Перенести Level Editor в Beta
7. Добавить этап Vertical Slice
8. Добавить раздел профилирования производительности

---

**Версия анализа:** 2.0  
**Дата:** 09.02.2026  
**Статус:** Требует применения исправлений
